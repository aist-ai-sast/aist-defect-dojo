<div class="modal fade" id="modalCreateVersion" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Create Project Version</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body" id="create-version-body">
                                        <div class="text-muted">Select a project first…</div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close
                                        </button>
                                        <button type="button" class="btn btn-primary" id="btn-submit-create-version">
                                            Create
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
<div class="modal fade" id="modalAiFilter" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create AI filter</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body aist-action-modal-body">
                    <div class="mb-2">
                        <label class="form-label">Save filter to</label>
                        <select id="ai-filter-scope" class="form-select">
                            <option value="PROJECT">Project</option>
                            <option value="ORG">Organization</option>
                        </select>
                    </div>

                    <div class="alert alert-secondary small">
                        Example:
                        <pre class="mb-0">{
  "limit": 50,
  "severity": [
    {"comparison": "EQUALS", "value": "High"},
    {"comparison": "EQUALS", "value": "Critical"}
  ]
}</pre>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="fw-semibold">Filter reference</div>
                            <button type="button" class="btn btn-outline-secondary btn-sm" id="btn-insert-ai-template">
                                Insert template
                            </button>
                        </div>

                        <div class="btn-group btn-group-sm mb-2" role="group" aria-label="AI filter reference tabs">
                            <button type="button" class="btn btn-outline-secondary active" id="ai-ref-tab-cmpr">
                                Comparisons
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="ai-ref-tab-fields">Fields
                            </button>
                        </div>

                        <div class="border rounded p-3" id="aiFilterRefContent">
                            <div id="ai-ref-cmpr-pane">
                                <div id="ai-cmpr-status" class="text-muted small mb-2">Loading reference…</div>
                                <div id="ai-cmpr-badges" class="d-flex flex-wrap"></div>
                                <div class="text-muted small mt-2">
                                    Comparison names are case-insensitive; they’ll be normalized to UPPERCASE.
                                </div>
                            </div>

                            <div id="ai-ref-fields-pane" style="display:none;">
                                <div id="ai-fields-status" class="text-muted small mb-2">Loading reference…</div>
                                <div class="table-responsive">
                                    <table class="table table-sm align-middle mb-0">
                                        <thead>
                                        <tr class="text-muted small">
                                            <th style="width: 22%">Field</th>
                                            <th style="width: 12%">Type</th>
                                            <th style="width: 36%">Allowed comparisons</th>
                                            <th style="width: 30%">Notes</th>
                                        </tr>
                                        </thead>
                                        <tbody id="ai-fields-tbody"></tbody>
                                    </table>
                                </div>
                                <div class="text-muted small mt-2">
                                    Fields are whitelisted and mapped to Django paths on backend.
                                </div>
                            </div>
                        </div>

                    </div>

                    <textarea id="ai-filter-editor" class="form-control font-monospace" rows="10"></textarea>
                    <div id="ai-filter-error" class="text-danger small mt-2" style="display:none;"></div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btn-save-ai-filter">Save</button>
                </div>
            </div>
        </div>
    </div>
<div class="modal fade" id="modalCreateLaunchAction" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add launch action</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="alert alert-danger" id="launchActionError" style="display:none;"></div>

                    <div class="aist-action-row">
                        <label class="form-label">Trigger status</label>
                        <select class="form-control" id="action-trigger-status">
                            {% for value, label in aist_status_choices %}
                                <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="aist-action-spacer" aria-hidden="true"></div>

                    <div class="aist-action-row">
                        <label class="form-label">Action type</label>
                        <select class="form-control" id="action-type">
                            {% for value, label in aist_action_types %}
                                <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="aist-action-spacer" aria-hidden="true"></div>

                    <div id="action-common-fields">
                        <div class="aist-action-row">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="action-title">
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                        <div class="aist-action-row">
                            <label class="form-label">Description (optional)</label>
                            <textarea class="form-control" id="action-description" rows="3"></textarea>
                            <div class="text-muted small mt-1">
                                If you set a description, it will replace the auto-generated AI report summary in Slack/email.
                            </div>
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                        <div class="aist-action-row">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="action-include-ai-csv">
                                <label class="form-check-label" for="action-include-ai-csv">
                                    Add AI result CSV
                                </label>
                            </div>
                            <div class="text-muted small mt-1">
                                If AI response isn’t ready at the selected status, the action will be marked failed.
                            </div>
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                    </div>

                    <div id="action-slack-fields" style="display:none;">
                        <div class="aist-action-row">
                            <label class="form-label">Slack channels or ID (comma-separated)</label>
                            <input type="text" class="form-control" id="action-slack-channels" placeholder="#aist-alerts, #secops">
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                        <div class="aist-action-row">
                            <label class="form-label">Slack token</label>
                            <input type="password" class="form-control" id="action-slack-token" autocomplete="off">
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                    </div>

                    <div id="action-email-fields" style="display:none;">
                        <div class="aist-action-row">
                            <label class="form-label">Emails (comma-separated)</label>
                            <input type="text" class="form-control" id="action-emails" placeholder="secops@example.com, lead@example.com">
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                    </div>

                    <div id="action-log-fields" style="display:none;">
                        <div class="aist-action-row">
                            <label class="form-label">Log level</label>
                            <select class="form-control" id="action-log-level">
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                                <option value="DEBUG">DEBUG</option>
                            </select>
                        </div>
                        <div class="aist-action-spacer" aria-hidden="true"></div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btn-save-launch-action">Save action</button>
                </div>
            </div>
        </div>
    </div>
<style>
                            #ai-cmpr-badges .badge {
                                margin: 2px 6px 2px 0;
                            }

                            #aiFilterRefContent {
                                background: var(--bs-body-bg, #fff);
                            }

                            #ai-cmpr-badges .badge {
                                font-weight: 600;
                                letter-spacing: .2px;
                            }

                            #aiFilterRefContent {
                                background: var(--bs-body-bg, #fff);
                            }

                            #aiFilterRefTabs .nav-link {
                                font-size: .9rem;
                            }

                            /* Keep modal title and close button on one line */
                            #modalCreateVersion .modal-header {
                                display: flex;
                                align-items: center;
                                justify-content: space-between;
                                padding: 10px 15px;
                            }

                            .aist-action-modal-body .form-label {
                                margin-bottom: 6px;
                            }

                            .aist-action-modal-body .form-control {
                                margin-bottom: 2px;
                            }

                            .aist-action-modal-body .aist-action-row {
                                display: block !important;
                                padding-bottom: 12px !important;
                            }

                            .aist-action-modal-body .aist-action-row + .aist-action-row {
                                margin-top: 12px !important;
                            }

                            .aist-action-modal-body select.form-control,
                            .aist-action-modal-body input.form-control,
                            .aist-action-modal-body textarea.form-control {
                                margin-bottom: 0 !important;
                            }

                            .aist-action-spacer {
                                display: block;
                                height: 12px;
                            }

                            #modalCreateVersion .modal-title {
                                flex: 1;
                                text-align: left;
                                font-weight: 600;
                                margin: 0;
                            }

                            #modalCreateVersion .close {
                                float: none;
                                margin-left: auto;
                                line-height: 1;
                                opacity: .6;
                            }

                            #modalCreateVersion .close:hover {
                                opacity: 1;
                            }
                        </style>
